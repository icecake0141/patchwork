<!-- SPDX-License-Identifier: Apache-2.0 -->
<!-- This file was created or modified with the assistance of an AI (Large Language Model). -->
{% extends "base.html" %}
{% block content %}
<div class="card">
	<h1>Project {{ project_id }}</h1>
	<p><a href="/diff/{{ project_id }}">Diff View</a></p>
</div>

<div class="card">
	<h2>Revisions</h2>
	<ul>
	{% for r in revisions %}
	<li><a href="/projects/{{ project_id }}?revision_id={{ r.revision_id }}">{{ r.revision_id }} ({{ r.created_at }})</a></li>
	{% endfor %}
	</ul>
</div>

{% if chosen %}
<div class="card">
	<h2>Revision {{ chosen.revision_id }}</h2>
	<p class="muted">Downloads are grouped by content. SVG and Draw.io in the same row represent the same content in different formats.</p>
	<table>
	<tr><th>group</th><th>description</th><th>downloads</th></tr>
	<tr>
		<td>Raw Data</td>
		<td>Detailed cabling session data in tabular format.</td>
		<td><a href="/revisions/{{ chosen.revision_id }}/export/sessions.csv">sessions.csv</a></td>
	</tr>
	<tr>
		<td>Raw Data</td>
		<td>Bill of Materials (BoM) summary list.</td>
		<td><a href="/revisions/{{ chosen.revision_id }}/export/bom.csv">bom.csv</a></td>
	</tr>
	<tr>
		<td>Raw Data</td>
		<td>Complete allocation result in JSON format.</td>
		<td><a href="/revisions/{{ chosen.revision_id }}/export/result.json">result.json</a></td>
	</tr>
	<tr>
		<td>Cable Wiring Diagram</td>
		<td>Cable wiring diagram with detailed connections.</td>
		<td>
			<a href="/revisions/{{ chosen.revision_id }}/export/wiring.svg">SVG</a>
			 /
			<a href="/revisions/{{ chosen.revision_id }}/export/wiring.drawio">Draw.io</a>
		</td>
	</tr>
	<tr>
		<td>Integrated Wiring View</td>
		<td>Integrated wiring view including Aggregate and Detailed modes.</td>
		<td><a href="/revisions/{{ chosen.revision_id }}/export/integrated_wiring.drawio">Draw.io</a></td>
	</tr>
	<tr>
		<td>Integrated Wiring View (Interactive)</td>
		<td>Integrated wiring SVG with built-in interactive filters.</td>
		<td>
			<a href="/revisions/{{ chosen.revision_id }}/export/integrated_wiring_interactive.svg?mode=aggregate">SVG (Aggregate)</a>
			 /
			<a href="/revisions/{{ chosen.revision_id }}/export/integrated_wiring_interactive.svg?mode=detailed">SVG (Detailed)</a>
		</td>
	</tr>
	<tr>
		<td>Rack Occupancy</td>
		<td>Rack occupancy diagram exported as a single-sheet view.</td>
		<td><a href="/revisions/{{ chosen.revision_id }}/export/rack_occupancy.drawio">Draw.io</a></td>
	</tr>
	</table>
	<p>Sessions: {{ result.metrics.session_count }} / Modules: {{ result.metrics.module_count }}</p>
</div>

<div class="card">
	<h2>Rack Topology</h2>
	<table>
	<tr><th>rack_a</th><th>rack_b</th><th>media</th><th>count</th></tr>
	{% for row in topology_rows %}
	<tr>
		<td>{{ row.rack_a }}</td>
		<td>{{ row.rack_b }}</td>
		<td>{{ row.media }}</td>
		<td>{{ row.count }}</td>
	</tr>
	{% endfor %}
	</table>
</div>

<div class="card">
	<h2>Bill of Materials</h2>
	<table>
	<tr><th>item_type</th><th>description</th><th>quantity</th></tr>
	{% for row in bom_rows %}
	<tr>
		<td>{{ row.item_type }}</td>
		<td>{{ row.description }}</td>
		<td>{{ row.quantity }}</td>
	</tr>
	{% endfor %}
	</table>
</div>

<div class="card">
	<h2>Rack Occupancy</h2>
	{% for rack,svg in rack_svgs.items() %}
	<h3>{{ rack }}</h3>
	<div>{{ svg|safe }}</div>
	{% endfor %}
</div>

<div class="card">
	<h2>Cable Wiring Diagram</h2>
	<div>{{ wiring_svg|safe }}</div>
</div>

<div class="card" data-role="integrated-card">
	<h2>Integrated Wiring View</h2>
	<div class="integrated-controls">
		<fieldset>
			<legend>Mode</legend>
			<label><input type="radio" name="integrated_mode_project" value="aggregate" data-role="integrated-mode" checked> Aggregate</label>
			<label><input type="radio" name="integrated_mode_project" value="detailed" data-role="integrated-mode"> Detailed</label>
		</fieldset>
		<fieldset>
			<legend>Media Filter</legend>
			{% for media in integrated_media_types %}
			<label><input type="checkbox" value="{{ media }}" data-role="integrated-media" checked> {{ media }}</label>
			{% endfor %}
		</fieldset>
		<fieldset>
			<legend>Rack Filter</legend>
			{% for rack in integrated_racks %}
			<label><input type="checkbox" value="{{ rack }}" data-role="integrated-rack" checked> {{ rack }}</label>
			{% endfor %}
		</fieldset>
	</div>
	<div class="integrated-legend">
		{% for media in integrated_media_types %}
		<span class="integrated-legend-item">
			<span class="integrated-legend-color" data-role="integrated-legend-color" data-media="{{ media }}"></span>
			{{ media }}
		</span>
		{% endfor %}
	</div>
	<div class="integrated-scroll">
		<div data-role="integrated-mode-panel" data-mode="aggregate">{{ integrated_wiring_svgs.aggregate|safe }}</div>
		<div data-role="integrated-mode-panel" data-mode="detailed" style="display:none">{{ integrated_wiring_svgs.detailed|safe }}</div>
	</div>
</div>
{% endif %}
{% endblock %}
