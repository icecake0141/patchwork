<!-- SPDX-License-Identifier: Apache-2.0 -->
<!-- This file was created or modified with the assistance of an AI (Large Language Model). -->
{% extends "base.html" %}
{% block content %}
<div class="card">
  <h1>Trial Result</h1>
  <p>Sessions: {{ result.metrics.session_count }} / Modules: {{ result.metrics.module_count }}</p>
</div>

<div class="card">
  <h2>Rack Topology</h2>
  <table>
  <tr><th>rack_a</th><th>rack_b</th><th>media</th><th>count</th></tr>
  {% for row in topology_rows %}
  <tr>
    <td>{{ row.rack_a }}</td>
    <td>{{ row.rack_b }}</td>
    <td>{{ row.media }}</td>
    <td>{{ row.count }}</td>
  </tr>
  {% endfor %}
  </table>
</div>

<div class="card">
  <h2>Bill of Materials</h2>
  <table>
  <tr><th>item_type</th><th>description</th><th>quantity</th></tr>
  {% for row in bom_rows %}
  <tr>
    <td>{{ row.item_type }}</td>
    <td>{{ row.description }}</td>
    <td>{{ row.quantity }}</td>
  </tr>
  {% endfor %}
  </table>
</div>

<div class="card">
  <h2>Rack Occupancy</h2>
  {% for rack,svg in rack_svgs.items() %}
  <h3>{{ rack }}</h3>
  <div>{{ svg|safe }}</div>
  {% endfor %}
</div>

<div class="card">
  <h2>Cable Wiring Diagram</h2>
  <div>{{ wiring_svg|safe }}</div>
</div>

<div class="card" data-role="integrated-card">
  <h2>Integrated Wiring View</h2>
  <p class="muted">Tip: click wire/label to focus. Click again or blank area to clear.</p>
  <div class="integrated-controls">
    <fieldset>
      <legend>Mode</legend>
      <label><input type="radio" name="integrated_mode_trial" value="aggregate" data-role="integrated-mode" checked> Aggregate</label>
      <label><input type="radio" name="integrated_mode_trial" value="detailed" data-role="integrated-mode"> Detailed</label>
    </fieldset>
    <fieldset>
      <legend>Media Filter</legend>
      {% for media in integrated_media_types %}
      <label><input type="checkbox" value="{{ media }}" data-role="integrated-media" checked> {{ media }}</label>
      {% endfor %}
    </fieldset>
    <fieldset>
      <legend>Rack Filter</legend>
      {% for rack in integrated_racks %}
      <label><input type="checkbox" value="{{ rack }}" data-role="integrated-rack" checked> {{ rack }}</label>
      {% endfor %}
    </fieldset>
    <fieldset>
      <legend>Port State</legend>
      <label><input type="checkbox" value="occupied" data-role="integrated-port-state" checked> occupied</label>
      <label><input type="checkbox" value="free" data-role="integrated-port-state" checked> free</label>
    </fieldset>
    <fieldset>
      <legend>Anchor Label</legend>
      <label><input type="checkbox" data-role="integrated-anchor-label-toggle" checked> show P# in anchor box</label>
    </fieldset>
    <fieldset>
      <legend>Gap Jump Scale</legend>
      <label>
        <select data-role="integrated-gap-scale">
          <option value="0.50">Auto × 0.50</option>
          <option value="1.0" selected>Auto</option>
          <option value="0.75">Auto × 0.75</option>
          <option value="1.25">Auto × 1.25</option>
          <option value="1.50">Auto × 1.50</option>
          <option value="2.00">Auto × 2.00</option>
        </select>
      </label>
    </fieldset>
  </div>
  <div class="integrated-legend">
    {% for media in integrated_media_types %}
    <span class="integrated-legend-item">
      <span class="integrated-legend-color" data-role="integrated-legend-color" data-media="{{ media }}"></span>
      {{ media }}
    </span>
    {% endfor %}
  </div>
  <div class="integrated-scroll">
    <div data-role="integrated-mode-panel" data-mode="aggregate">{{ integrated_wiring_svgs.aggregate|safe }}</div>
    <div data-role="integrated-mode-panel" data-mode="detailed" style="display:none">{{ integrated_wiring_svgs.detailed|safe }}</div>
  </div>
</div>

<div class="card">
  <h2>Session Preview</h2>
  <table>
  <tr><th>session_id</th><th>media</th><th>src</th><th>dst</th></tr>
  {% for s in result.sessions[:50] %}
  <tr><td>{{ s.session_id }}</td><td>{{ s.media }}</td><td>{{ s.label_a }}</td><td>{{ s.label_b }}</td></tr>
  {% endfor %}
  </table>
</div>

<div class="card">
  <h2>Save</h2>
  <form method="post" action="/save">
    <input type="text" name="project_name" placeholder="project name" required>
    <input type="text" name="note" placeholder="revision note">
    <button type="submit">Save</button>
  </form>
</div>
{% endblock %}
